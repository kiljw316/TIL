> SFU (Selective Forwarding Unit) 서버 방식: 종단 간 미디어 트래픽을 중계하는 중앙 서버 방식

# P2P 방식에서 SFU 방식으로의 전환 이유

- 기존 P2P 방식은 연결된 mesh 네트워크 방식을 사용하여 미디어를 교환
- 서버를 사용하지 않기에 서비비를 절약할 수 있는 장점

- 하지만 여러 가지 문제들이 발생

  - 참여자가 많아지면 송출자의 컴퓨터에 큰 부하가 걸림
  - 문제가 발생해도 데이터들이 서버를 거치지 않기 때문에 그 원인을 파악하기 어려워 대응책 마련이 불가능

- 또한 1대1 뿐만이 아니라 다자간 통신에 대한 수요가 꾸준히 증가하면서 P2P가 아닌 미디어 서버를 활용한 실시간 통신의 필요성 대두
- 이에 SFU 방식으로의 구현을 준비

# SFU 방식의 장점

1. 클라이언트의 부담이 적다.

n명의 인원이 참여하는 다자간 통신 환경을 생각해볼 때, 본인을 제외한 나머지 n-1 명에게 데이터를 모두 전송해야하는 메쉬 네트워킹 방식과는 달리 SFU 방식은 1곳의 미디어 서버에게만 데이터를 전송
그렇기에 각 사용자 사이에 오가는 트래픽과 사용자 및 서버의 CPU 사용량 등을 경감할 수 있음

2. 네트워크 모니터링이 가능

P2P 방식의 경우는 서버를 거치지 않는 방식이기에 모니터링이 불가능하고, 오류의 원인을 찾아낼 방법이 없다. 반면 미디어 서버를 활용하는 SFU 방식은 네트워크 모니터링을 통해 송신자와 수신자 중 어디에 오류가 있는지 쉽게 알아내고 디버깅할 수 있음

# 미디어 서버

## 미디어 서버란

사용자들로부터 각각의 미디어 스트림을 받아 매 순간마다 선택적으로 전달하는 라우팅 머신 역할의 중간 서버

중간 서버에서는 별도의 미디어 가공 과정을 거치지 않고 그대로 각 사용자들에게 전달하며, 각 피어간 연결 할당 \* 암호화 및 복호화 처리 비용 정도를 감수

비교적 서버에 부하가 적게 걸리고 지연시간 역시 낮기에 영상 방송과 같은 1:N 스트리밍 서비스, 혹은 조금 더 확장하여 N:N 소통에 폭넓게 사용됨

## AWS EC2 Auto Scaling 도입

- 성능과 비용을 최적화하거나 둘 사이의 적절한 균형을 유지하기 위한 권장 사항을 활용해 손쉽게 조정을 설정

- 예를 들어 최소 인스턴스 수 1개, 원하는 인스턴스 용량 2개, 최대 인스턴스 수 4개가 됩니다. 사용자가 정의한 조정 정책에 따라 인스턴스 수가 최소 및 최대 인스턴스 수 내에서 지정하는 조건에 따라 조절됩니다.

![as-basic-diagram](https://user-images.githubusercontent.com/87928719/151394958-33c59c56-5913-4a9c-b8bf-2597da7d9003.png)

[이미지 출처](https://docs.aws.amazon.com/ko_kr/autoscaling/ec2/userguide/what-is-amazon-ec2-auto-scaling.html)

## Scale-out 시 문제점
Scale-out된 여러대의 서버는 서로 독립적으로 가동되고 있기 때문에 각기 다른 서버로 접속한 참여자들 사이에서는 미디어 전송이 이루어질 수 없음
따라서 미디어 서버끼리 서로 연결될 수 있도록 구현해야함

[자료 출처](https://post.naver.com/viewer/postView.naver?volumeNo=29387570&memberNo=50640104)
